---
- hosts: nodes
  vars:
   userlist:
    alice:
     email: Alice@example.com
     homedir: /home/alice
     password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          30613333323534383064386239636166656537666635633833356137643332636162326662386362
          3761366662653633663032326133313464303237323333370a623032643738336566376632353638
          31313065626436656438393039396666643738336364353463646232313137373065653163616363
          6362366532363935640a343361333064643465356634313264323761376435343731396132656530
          35663161333736343361663839353232343531353637326561613031656535653037396161373835
          30626461333134376235653232346266376531666565656161343738363266303165613130306130
          31613338613262366130386662343138393836333466653261633136643562653435636534656332
          64306361623865333933626162346162643566346366386439646462373735616635633036656438
          3630
    bob:
     email: Bob@example.com
     homedir: /home/bob
     password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          39626634353436653839666166356364303462356365363761623662313864623237643933306634
          3836616634323466636230336532306664393039376338310a383062343937643561326233393135
          32373365323930653438376436356465656162373033613566656539303461653034333430343238
          3732663364373838660a643138303034356534396539333334353265396634383732356635323231
          65386330313866636435316535346635326534666464656535613038363535313263633638313261
          36313838386262373731393161343637363631333536636562343361336630666265386361656638
          62346338663761376566323531303936633365636463393030663533393234346466366132633734
          39326564663861333339366632366631623831373138333636373063326166373836653439616466
          6663
    carol:
     email: Carol@example.com
     homedir: /home/carol
     password: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          36653833393730366232346163636463626563343762363332343837343831633665303633373033
          6466333236613939313038373766336239316562313737640a316137316431313737386361663738
          33353733346235353134363132643138623466313236363066313634633939643936373437313538
          6634656231623939650a383566306163313261303866613661363836303562633139373236373264
          35643834626632353430633837653364623032343662623938353230356262333466393436396366
          35356463656531643137386266663233643339383038383336623231303266636537323965613836
          64656263613439333432306462613431633062646461613437393332316533316639343961306430
          39613431663633663264306563346364343962323532626562636138636461626133623235646431
          3730
  tasks:
  - name: Adding users
    user:
      update_password: on_create
      create_home: yes
      state: present
      name: "{{item.key}}"
      comment: "{{item.value.email}}"
      home: "{{item.value.homedir}}"
      password: "{{item.value.password}}"
    with_dict: "{{ userlist }}"
